<!DOCTYPE html>
<html>
<head>
    <title>Real-time Test</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Supabase Real-time Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>

    <script>
        const SUPABASE_URL = "https://loshvtjahbhenrfgpvge.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxvc2h2dGphaGJoZW5yZmdwdmdlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5ODcxNjMsImV4cCI6MjA3MTU2MzE2M30.cFR1LAnH9wwYeWDstl2rSXBSeJUu7fiMqbwlvUV8ySk";

        const { createClient } = supabase;
        const client = createClient(SUPABASE_URL, SUPABASE_KEY);

        const statusDiv = document.getElementById('status');
        const messagesDiv = document.getElementById('messages');

        function log(message) {
            const p = document.createElement('p');
            p.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            messagesDiv.appendChild(p);
            console.log(message);
        }

        // Test real-time subscription
        const channel = client
            .channel('test-channel')
            .on('postgres_changes', 
                { event: '*', schema: 'public', table: 'items' },
                (payload) => {
                    log(`Items change: ${payload.eventType}`);
                    console.log('Full payload:', payload);
                }
            )
            .on('postgres_changes',
                { event: '*', schema: 'public', table: 'columns' },
                (payload) => {
                    log(`Columns change: ${payload.eventType}`);
                }
            )
            .subscribe((status) => {
                statusDiv.textContent = `Status: ${status}`;
                log(`Subscription status: ${status}`);
                
                if (status === 'SUBSCRIBED') {
                    statusDiv.style.color = 'green';
                    log('✅ Successfully connected to real-time!');
                } else if (status === 'CHANNEL_ERROR') {
                    statusDiv.style.color = 'red';
                    log('❌ Channel error!');
                } else if (status === 'CLOSED') {
                    statusDiv.style.color = 'orange';
                    log('🔒 Channel closed');
                }
            });

        // Test database connection
        async function testDatabase() {
            const { data, error } = await client
                .from('projects')
                .select('id, name')
                .limit(1);
            
            if (error) {
                log(`❌ Database error: ${error.message}`);
            } else {
                log(`✅ Database connected! Found ${data.length} project(s)`);
            }
        }

        testDatabase();

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            client.removeChannel(channel);
        });
    </script>
</body>
</html>